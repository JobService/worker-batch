{
  "id": "/${marathon-group}/batch",
  "cpus": "${batch-cpus}",
  "mem": "${batch-mem}",
  "dependencies": ["/${marathon-group}/${rabbit-id}"],
  "instances": "${batch-autoscale.mininstances}",
  "container": {
    "type": "DOCKER",
    "docker": {
      "image": "${docker-registry}/caf/worker-batch:${batch-version}",
      "network": "BRIDGE",
      "portMappings": [
        {
          "containerPort": 8080,
          "hostPort": 0,
          "servicePort": "${batch-8080-serviceport}",
          "protocol": "tcp"
        },
        {
          "containerPort": 8081,
          "hostPort": 0,
          "servicePort": "${batch-8081-serviceport}",
          "protocol": "tcp"
        }
      ],
      "privileged": true,
      "forcePullImage": "${forcePullImage}"
    },
    "volumes": [
      {
        "containerPath": "/etc/store",
        "hostPath": "${caf-fs-storage-hostPath}",
        "mode": "RW"
      }
    ]
  },
  "env": {
    "_JAVA_OPTIONS": "-Xms${batch-java-mem-min}m -Xmx${batch-java-mem-max}m",
    "CAF_CONFIG_PATH": "/mnt/mesos/sandbox"
  },
  "labels": {
    "autoscale.metric": "${batch-autoscale.metric}",
    "autoscale.scalingtarget": "${marathon-group}-batch-in",
    "autoscale.scalingprofile": "${batch-autoscale.scalingprofile}",
    "autoscale.maxinstances": "${batch-autoscale.maxinstances}",
    "autoscale.mininstances": "${batch-autoscale.mininstances}"
  },
  "healthChecks": [
    {
      "path": "/healthcheck",
      "portIndex": 1,
      "protocol": "HTTP",
      "gracePeriodSeconds": "${batch-healthcheck-graceperiodseconds}",
      "intervalSeconds": "${batch-healthcheck-intervalseconds}",
      "maxConsecutiveFailures": "${batch-healthcheck-maxconsecutivefailures}",
      "timeoutSeconds": "${batch-healthcheck-timeoutseconds}"
    }
  ],
  "uris": [
    "${marathon-uris-root}/${worker-config-location}/cfg_${marathon-group}_worker-batch_BatchWorkerConfiguration",
    "${marathon-uris-root}/${worker-config-location}/cfg_${marathon-group}_worker-batch_RabbitWorkerQueueConfiguration",
    "${marathon-uris-root}/${worker-config-location}/cfg_${marathon-group}_worker-batch_FileSystemDataStoreConfiguration",
    "${marathon-uris-root}/${worker-config-location}/cfg_${marathon-group}_worker-batch_StorageServiceDataStoreConfiguration",
    "${marathon-uris-root}/${batch-plugin-location}/batch-plugins.tar.gz",
    "${marathon-uris-root}/${docker-login-config}"
  ]
}

